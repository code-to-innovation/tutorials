{
  "meta": {
    "instanceId": "n8n"
  },
  "nodes": [
    {
      "parameters": {
        "events": ["pull_request"],
        "owner": "YOUR_GITHUB_USERNAME",
        "repository": "YOUR_REPO_NAME"
      },
      "id": "github-trigger-1",
      "name": "GitHub Trigger",
      "type": "n8n-nodes-base.githubTrigger",
      "typeVersion": 1,
      "position": [240, 300]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{$json.action}}",
              "operation": "equals",
              "value2": "opened"
            },
            {
              "value1": "={{$json.action}}",
              "operation": "equals",
              "value2": "synchronize"
            }
          ]
        },
        "combineOperation": "any"
      },
      "id": "if-filter-2",
      "name": "Filter PR Events",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [460, 300]
    },
    {
      "parameters": {
        "method": "GET",
        "url": "=https://api.github.com/repos/{{$json.repository.owner.login}}/{{$json.repository.name}}/pulls/{{$json.number}}/files",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "githubApi"
      },
      "id": "http-files-3",
      "name": "Get PR Files",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [680, 300]
    },
    {
      "parameters": {
        "functionCode": "const files = $input.all();\nconst issues = [];\nconst suggestions = [];\n\nfiles.forEach(file => {\n  const filename = file.json.filename;\n  const patch = file.json.patch || '';\n  const additions = file.json.additions;\n  \n  if (patch.includes('console.log')) {\n    issues.push(`ðŸ” **${filename}**: Remove console.log statements`);\n  }\n  \n  if (patch.includes('debugger')) {\n    issues.push(`ðŸ› **${filename}**: Remove debugger statement`);\n  }\n  \n  if (patch.match(/TODO|FIXME/i)) {\n    issues.push(`ðŸ“ **${filename}**: TODO/FIXME found`);\n  }\n  \n  if (patch.match(/api[_-]?key|password|secret|token/i)) {\n    issues.push(`ðŸ”’ **${filename}**: Potential secret detected`);\n  }\n  \n  if (additions > 500) {\n    suggestions.push(`ðŸ“¦ **${filename}**: Large file (+${additions} lines)`);\n  }\n  \n  if (patch.includes('fetch(') && !patch.includes('catch')) {\n    suggestions.push(`âš ï¸ **${filename}**: fetch() without .catch()`);\n  }\n});\n\nlet comment = '## ðŸ¤– Automated Code Review\\n\\n';\n\nif (issues.length === 0 && suggestions.length === 0) {\n  comment += 'âœ… **No issues found!** Code looks good.\\n';\n} else {\n  if (issues.length > 0) {\n    comment += '### âŒ Issues Found\\n\\n';\n    issues.forEach(i => comment += `- ${i}\\n`);\n    comment += '\\n';\n  }\n  if (suggestions.length > 0) {\n    comment += '### ðŸ’¡ Suggestions\\n\\n';\n    suggestions.forEach(s => comment += `- ${s}\\n`);\n  }\n}\n\ncomment += '\\n---\\n_Automated review by n8n bot_';\n\nconst triggerData = $node['GitHub Trigger'].json;\n\nreturn [{\n  json: {\n    comment: comment,\n    prNumber: triggerData.number,\n    repo: triggerData.repository.name,\n    owner: triggerData.repository.owner.login\n  }\n}];"
      },
      "id": "code-analyze-4",
      "name": "Analyze Code",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [900, 300]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://api.github.com/repos/{{$json.owner}}/{{$json.repo}}/issues/{{$json.prNumber}}/comments",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "githubApi",
        "jsonParameters": true,
        "bodyParametersJson": "={\"body\": \"{{$json.comment}}\"}"
      },
      "id": "http-comment-5",
      "name": "Post Review Comment",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [1120, 300]
    }
  ],
  "connections": {
    "GitHub Trigger": {
      "main": [
        [
          {
            "node": "Filter PR Events",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter PR Events": {
      "main": [
        [
          {
            "node": "Get PR Files",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get PR Files": {
      "main": [
        [
          {
            "node": "Analyze Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Analyze Code": {
      "main": [
        [
          {
            "node": "Post Review Comment",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  }
}
