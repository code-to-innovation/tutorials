{
  "name": "Auto Code Review Bot",
  "nodes": [
    {
      "parameters": {
        "owner": {
          "__rl": true,
          "mode": "name",
          "value": "YOUR_GITHUB_USERNAME"
        },
        "repository": {
          "__rl": true,
          "mode": "name",
          "value": "YOUR_REPO_NAME"
        },
        "events": [
          "pull_request"
        ],
        "options": {}
      },
      "type": "n8n-nodes-base.githubTrigger",
      "typeVersion": 1,
      "position": [0, 0],
      "id": "github-trigger-node",
      "name": "Github Trigger",
      "webhookId": "auto-generated",
      "credentials": {
        "githubApi": {
          "id": "YOUR_CREDENTIAL_ID",
          "name": "GitHub account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "condition-1",
              "leftValue": "={{ $json.action }}",
              "rightValue": "opened",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "condition-2",
              "leftValue": "={{ $json.action }}",
              "rightValue": "synchronize",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [220, 0],
      "id": "if-filter-node",
      "name": "Filter PR Events"
    },
    {
      "parameters": {
        "method": "GET",
        "url": "=https://api.github.com/repos/{{ $json.repository.owner.login }}/{{ $json.repository.name }}/pulls/{{ $json.number }}/files",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "githubApi",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [440, 0],
      "id": "get-files-node",
      "name": "Get PR Files",
      "credentials": {
        "githubApi": {
          "id": "YOUR_CREDENTIAL_ID",
          "name": "GitHub account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const files = $input.all();\nconst issues = [];\nconst suggestions = [];\n\nfiles.forEach(file => {\n  const filename = file.json.filename;\n  const patch = file.json.patch || '';\n  const additions = file.json.additions;\n  \n  if (patch.includes('console.log')) {\n    issues.push(`ðŸ” **${filename}**: Remove console.log statements`);\n  }\n  \n  if (patch.includes('debugger')) {\n    issues.push(`ðŸ› **${filename}**: Remove debugger statement`);\n  }\n  \n  if (patch.match(/TODO|FIXME/i)) {\n    issues.push(`ðŸ“ **${filename}**: TODO/FIXME found`);\n  }\n  \n  if (patch.match(/api[_-]?key|password|secret|token/i)) {\n    issues.push(`ðŸ”’ **${filename}**: Potential secret detected`);\n  }\n  \n  if (additions > 500) {\n    suggestions.push(`ðŸ“¦ **${filename}**: Large file (+${additions} lines)`);\n  }\n  \n  if (patch.includes('fetch(') && !patch.includes('catch')) {\n    suggestions.push(`âš ï¸ **${filename}**: fetch() without .catch()`);\n  }\n});\n\nlet comment = '## ðŸ¤– Automated Code Review\\n\\n';\n\nif (issues.length === 0 && suggestions.length === 0) {\n  comment += 'âœ… **No issues found!** Code looks good.\\n';\n} else {\n  if (issues.length > 0) {\n    comment += '### âŒ Issues Found\\n\\n';\n    issues.forEach(i => comment += `- ${i}\\n`);\n    comment += '\\n';\n  }\n  if (suggestions.length > 0) {\n    comment += '### ðŸ’¡ Suggestions\\n\\n';\n    suggestions.forEach(s => comment += `- ${s}\\n`);\n  }\n}\n\ncomment += '\\n---\\n_Automated review by n8n bot_';\n\nconst trigger = $('Github Trigger').item.json;\n\nreturn [{\n  json: {\n    comment: comment,\n    prNumber: trigger.number,\n    repo: trigger.repository.name,\n    owner: trigger.repository.owner.login\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [660, 0],
      "id": "analyze-code-node",
      "name": "Analyze Code"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://api.github.com/repos/{{ $json.owner }}/{{ $json.repo }}/issues/{{ $json.prNumber }}/comments",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "githubApi",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"body\": \"{{ $json.comment }}\"\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [880, 0],
      "id": "post-comment-node",
      "name": "Post Review Comment",
      "credentials": {
        "githubApi": {
          "id": "YOUR_CREDENTIAL_ID",
          "name": "GitHub account"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "Github Trigger": {
      "main": [
        [
          {
            "node": "Filter PR Events",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter PR Events": {
      "main": [
        [
          {
            "node": "Get PR Files",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get PR Files": {
      "main": [
        [
          {
            "node": "Analyze Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Analyze Code": {
      "main": [
        [
          {
            "node": "Post Review Comment",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "1",
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "id": "auto-code-review-bot",
  "tags": []
}
