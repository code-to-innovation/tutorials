{
  "name": "Github Auto Code Review Bot",
  "nodes": [
    {
      "parameters": {
        "owner": {
          "__rl": true,
          "mode": "name",
          "value": "<<user name>>"
        },
        "repository": {
          "__rl": true,
          "mode": "name",
          "value": "<<repository anme>>"
        },
        "events": [
          "pull_request"
        ],
        "options": {}
      },
      "type": "n8n-nodes-base.githubTrigger",
      "typeVersion": 1,
      "position": [
        -416,
        0
      ],
      "id": "3841456a-efaf-4a2a-8a6d-0cb3ac3b0db4",
      "name": "Github Trigger",
      "webhookId": "8c340c76-52fe-48a0-a3eb-6b0eb1bd5b90",
      "executeOnce": false,
      "credentials": {
        "githubApi": {
          "id": "",
          "name": ""
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const json = $input.first().json;\n\nconst repo = json.repository || json.body?.repository;\nconst number = json.number || json.body?.number;\nconst action = json.action || json.body?.action;  // ADD THIS LINE\n\nif (!repo) {\n  throw new Error('Repository not found in data');\n}\n\nreturn [{\n  json: {\n    filesUrl: `https://api.github.com/repos/${repo.owner.login}/${repo.name}/pulls/${number}/files`,\n    commentsUrl: `https://api.github.com/repos/${repo.owner.login}/${repo.name}/issues/${number}/comments`,\n    prNumber: number,\n    repo: repo.name,\n    owner: repo.owner.login,\n    action: action\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -144,
        0
      ],
      "id": "95666ade-5407-453f-b249-d280ce58fcbf",
      "name": "Build API URLs"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "5404baa3-b118-42e1-9c75-ebb67a3f5118",
              "leftValue": "={{ $json.action }}",
              "rightValue": "opened",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "36bbe2ca-c362-466c-9771-5a2b2037e00e",
              "leftValue": "={{ $json.action }}",
              "rightValue": "synchronize",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        144,
        0
      ],
      "id": "0e06c4ce-1a74-426d-83c1-803cd9b02a9f",
      "name": "Filter PR Actions"
    },
    {
      "parameters": {
        "url": "={{ $json.filesUrl }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "githubApi",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.4,
      "position": [
        416,
        -96
      ],
      "id": "1e69e9a4-5a79-4469-9f76-0d93d4a889b7",
      "name": "Fetch PR Files",
      "credentials": {
        "githubApi": {
          "id": "edrblxa9rGe8Qirj",
          "name": "GitHub account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const files = $input.all();\nconst issues = [];\nconst suggestions = [];\n\nfiles.forEach(file => {\n  const filename = file.json.filename;\n  const patch = file.json.patch || '';\n  const additions = file.json.additions;\n  \n  if (patch.includes('console.log')) {\n    issues.push(`ðŸ” **${filename}**: Remove console.log`);\n  }\n  \n  if (patch.includes('debugger')) {\n    issues.push(`ðŸ› **${filename}**: Remove debugger`);\n  }\n  \n  if (patch.match(/TODO|FIXME/i)) {\n    issues.push(`ðŸ“ **${filename}**: TODO/FIXME found`);\n  }\n  \n  if (additions > 500) {\n    suggestions.push(`ðŸ“¦ **${filename}**: Large file`);\n  }\n});\n\nlet comment = '## ðŸ¤– Code Review\\\\n\\\\n';\n\nif (issues.length === 0 && suggestions.length === 0) {\n  comment += 'âœ… No issues found!\\\\n';\n} else {\n  if (issues.length > 0) {\n    comment += '### âŒ Issues\\\\n';\n    issues.forEach(i => comment += `- ${i}\\\\n`);\n  }\n  if (suggestions.length > 0) {\n    comment += '\\\\n### ðŸ’¡ Suggestions\\\\n';\n    suggestions.forEach(s => comment += `- ${s}\\\\n`);\n  }\n}\n\n// Get URLs from Code in JavaScript1 node\nconst urlData = $('Build API URLs').item.json;\n\nreturn [{\n  json: {\n    comment: comment,\n    prNumber: urlData.prNumber,\n    repo: urlData.repo,\n    owner: urlData.owner,\n    commentsUrl: urlData.commentsUrl\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        624,
        -96
      ],
      "id": "53f3ded0-1701-414e-b319-24f28aafeabe",
      "name": "Analyze Code Quality"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $json.commentsUrl }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "githubApi",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "body",
              "value": "=={{ $json.comment }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.4,
      "position": [
        832,
        -96
      ],
      "id": "3b0d64bf-6221-46ca-89b3-f1c48195aa9b",
      "name": "Post Review Comment",
      "credentials": {
        "githubApi": {
          "id": "edrblxa9rGe8Qirj",
          "name": "GitHub account"
        }
      }
    }
  ],
  "connections": {
    "Github Trigger": {
      "main": [
        [
          {
            "node": "Build API URLs",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Build API URLs": {
      "main": [
        [
          {
            "node": "Filter PR Actions",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter PR Actions": {
      "main": [
        [
          {
            "node": "Fetch PR Files",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fetch PR Files": {
      "main": [
        [
          {
            "node": "Analyze Code Quality",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Analyze Code Quality": {
      "main": [
        [
          {
            "node": "Post Review Comment",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "binaryMode": "separate",
    "availableInMCP": false
  },
  "versionId": "dbaa9cfa-cbb3-4ff6-96e3-04efe1103ba4",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "8c23572dc436d41bf696f8bb342292849e65157d9a76f1622b998a186a451c8d"
  },
  "id": "tl2ISReoeCXfgRERhfp3p",
  "tags": []
}
